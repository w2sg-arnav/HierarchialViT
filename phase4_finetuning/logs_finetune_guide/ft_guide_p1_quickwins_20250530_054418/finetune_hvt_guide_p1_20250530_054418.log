2025-05-30 05:44:18 - root - INFO - [setup_logging:75] - Logging configured. Log file: /teamspace/studios/this_studio/cvpr25/phase4_finetuning/logs_finetune_guide/ft_guide_p1_quickwins_20250530_054418/finetune_hvt_guide_p1_20250530_054418.log. Logger 'root' Effective Level: DEBUG
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:191] - ======== Starting Phase 4 Fine-tuning (Run: ft_guide_p1_quickwins_20250530_054418) ========
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:192] - Full effective configuration for this run: {'seed': 42, 'device': 'cuda', 'PROJECT_ROOT_PATH': '/teamspace/studios/this_studio/cvpr25', 'PACKAGE_ROOT_PATH': '/teamspace/studios/this_studio/cvpr25/phase4_finetuning', 'run_name_suffix': 'ft_guide_p1_quickwins', 'log_dir': 'logs_finetune_guide', 'log_file_finetune_base': 'finetune_hvt_guide_p1', 'best_model_filename_base': 'best_finetuned_hvt_guide_p1', 'final_model_filename_base': 'final_finetuned_hvt_guide_p1', 'checkpoint_save_dir_name': 'checkpoints', 'enable_torch_compile': False, 'torch_compile_mode': 'reduce-overhead', 'matmul_precision': 'high', 'cudnn_benchmark': True, 'ssl_pretrained_backbone_path': '/teamspace/studios/this_studio/cvpr25/phase3_pretraining/pretrain_checkpoints_hvt_xl/hvt_xl_simclr_best_probe.pth', 'load_pretrained_backbone_from_ssl': False, 'resume_finetune_checkpoint_path': None, 'load_optimizer_scheduler_on_resume': False, 'ssl_pretrain_img_size_fallback': (448, 448), 'data_root': '/teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection', 'original_dataset_name': 'Original Dataset', 'augmented_dataset_name': None, 'img_size': (512, 512), 'num_classes': 7, 'train_split_ratio': 0.8, 'normalize_data': True, 'use_weighted_sampler': True, 'weighted_sampler_mode': 'inv_freq', 'num_workers': 4, 'prefetch_factor': 2, 'model_architecture_name': 'DiseaseAwareHVT_Finetuned_Guide_P1', 'hvt_params_for_model_init': {'patch_size': 14, 'embed_dim_rgb': 192, 'embed_dim_spectral': 192, 'spectral_channels': 0, 'depths': [3, 6, 24, 3], 'num_heads': [6, 12, 24, 48], 'mlp_ratio': 4.0, 'qkv_bias': True, 'model_drop_rate': 0.1, 'attn_drop_rate': 0.0, 'drop_path_rate': 0.1, 'norm_layer_name': 'LayerNorm', 'use_dfca': False, 'use_gradient_checkpointing': True, 'ssl_enable_mae': False, 'ssl_enable_contrastive': False, 'enable_consistency_loss_heads': False, 'dfca_embed_dim_match_rgb': True, 'dfca_num_heads': 32, 'dfca_drop_rate': 0.1, 'dfca_use_disease_mask': True, 'ssl_mae_mask_ratio': 0.75, 'ssl_mae_decoder_dim': 64, 'ssl_mae_norm_pix_loss': True, 'ssl_contrastive_projector_dim': 128, 'ssl_contrastive_projector_depth': 2}, 'epochs': 75, 'batch_size': 12, 'accumulation_steps': 4, 'amp_enabled': True, 'clip_grad_norm': 1.0, 'log_interval': 10, 'optimizer': 'AdamW', 'weight_decay': 0.05, 'optimizer_params': {'betas': (0.9, 0.999), 'eps': 1e-08}, 'freeze_backbone_epochs': 5, 'lr_head_frozen_phase': 0.001, 'lr_backbone_unfrozen_phase': 5e-05, 'lr_head_unfrozen_phase': 0.0005, 'scheduler': 'WarmupCosine', 'warmup_epochs': 5, 'eta_min_lr': 1e-07, 'loss_label_smoothing': 0.1, 'augmentations_enabled': True, 'use_enhanced_augmentations': False, 'evaluate_every_n_epochs': 1, 'early_stopping_patience': 20, 'metric_to_monitor_early_stopping': 'f1_macro', 'tta_enabled_val': False}
2025-05-30 05:44:18 - __main__ - INFO - [set_global_seed:72] - Global random seed set to: 42
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:195] - Device: cuda. GPU: Tesla T4
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:196] - cudnn.benchmark = True
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:198] - matmul_precision = 'high'
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:54] - [DATASET INIT - train] Root: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection, ImgSize: (512, 512), Normalize: True
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - train] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Original Dataset
2025-05-30 05:44:18 - phase4_finetuning.dataset - DEBUG - [__init__:67] - [DATASET INIT - train] Dataset name 'None' is None/empty, skipping.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:105] - [DATASET INIT - train] Total valid image paths collected: 2137 from ~2137 items considered.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:117] - [DATASET INIT - train] Dataset split size: 1709 samples.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:128] - [DATASET INIT - train] Base RGB Transforms: Compose(
      ToImage()
      ToDtype(scale=True)
      Resize(size=[512, 512], interpolation=InterpolationMode.BICUBIC, antialias=True)
      Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225], inplace=False)
)
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:54] - [DATASET INIT - val] Root: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection, ImgSize: (512, 512), Normalize: True
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - val] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Original Dataset
2025-05-30 05:44:18 - phase4_finetuning.dataset - DEBUG - [__init__:67] - [DATASET INIT - val] Dataset name 'None' is None/empty, skipping.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:105] - [DATASET INIT - val] Total valid image paths collected: 2137 from ~2137 items considered.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:117] - [DATASET INIT - val] Dataset split size: 428 samples.
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [__init__:128] - [DATASET INIT - val] Base RGB Transforms: Compose(
      ToImage()
      ToDtype(scale=True)
      Resize(size=[512, 512], interpolation=InterpolationMode.BICUBIC, antialias=True)
      Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225], inplace=False)
)
2025-05-30 05:44:18 - phase4_finetuning.dataset - INFO - [get_class_weights:196] - Computed class weights (inv_freq for loss) for split 'train': [1.191 0.684 1.179 1.115 1.387 0.533 2.806]
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:210] - Using WeightedRandomSampler.
2025-05-30 05:44:18 - __main__ - INFO - [main_execution_logic:215] - Dataloaders: Train batches=142, Val batches=36
2025-05-30 05:44:18 - phase2_model.models.hvt - INFO - [create_disease_aware_hvt:602] - Factory: Creating DiseaseAwareHVT for img_size: (512, 512), num_classes: 7
2025-05-30 05:44:18 - phase2_model.models.hvt - WARNING - [__init__:34] - PatchEmbed: Img dims (512, 512) not perfectly divisible by patch_size 14.
2025-05-30 05:44:21 - phase2_model.models.hvt - INFO - [__init__:325] - HVT: Running RGB stream only. No fusion.
2025-05-30 05:44:24 - phase2_model.models.hvt - INFO - [__init__:359] - DiseaseAwareHVT initialized for image size (512, 512) and 7 classes.
2025-05-30 05:44:24 - __main__ - INFO - [main_execution_logic:219] - Base HVT model instance created (num_classes=7).
2025-05-30 05:44:24 - __main__ - CRITICAL - [<module>:348] - Unhandled CRITICAL exception in __main__ execution: name 'model_hvt' is not defined
Traceback (most recent call last):
  File "/teamspace/studios/this_studio/cvpr25/phase4_finetuning/main.py", line 339, in <module>
    main_execution_logic()
  File "/teamspace/studios/this_studio/cvpr25/phase4_finetuning/main.py", line 222, in main_execution_logic
    all_head_params = [p for n, p in model_hvt.named_parameters() if n.startswith(head_module_name + ".")]
NameError: name 'model_hvt' is not defined
