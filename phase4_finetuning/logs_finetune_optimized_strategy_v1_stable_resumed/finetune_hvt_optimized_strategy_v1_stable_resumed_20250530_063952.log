2025-05-30 06:39:52 - root - INFO - [setup_logging:75] - Logging configured. Log file: /teamspace/studios/this_studio/cvpr25/phase4_finetuning/logs_finetune_optimized_strategy_v1_stable_resumed/finetune_hvt_optimized_strategy_v1_stable_resumed_20250530_063952.log. Logger 'root' Effective Level: INFO
2025-05-30 06:39:52 - __main__ - INFO - [main_execution_logic:307] - ======== Starting Phase 4: HVT Fine-tuning (Run ID: 20250530_063952) ========
2025-05-30 06:39:52 - __main__ - INFO - [main_execution_logic:308] - Full run configuration loaded. Log dir: /teamspace/studios/this_studio/cvpr25/phase4_finetuning/logs_finetune_optimized_strategy_v1_stable_resumed
2025-05-30 06:39:52 - __main__ - WARNING - [main_execution_logic:310] - Detailed debugging (NaNs, Gradients) is ON. Log level might be verbose.
2025-05-30 06:39:52 - __main__ - INFO - [set_global_seed:68] - Global random seed set to: 42
2025-05-30 06:39:52 - __main__ - INFO - [main_execution_logic:317] - Using device: cuda. GPU: Tesla T4
2025-05-30 06:39:52 - __main__ - INFO - [main_execution_logic:320] - Set matmul_precision to high
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:54] - [DATASET INIT - train] Root: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection, ImgSize: (448, 448), Normalize: True
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - train] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Original Dataset
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - train] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Augmented Dataset
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:105] - [DATASET INIT - train] Total valid image paths collected: 9137 from ~9137 items considered.
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:117] - [DATASET INIT - train] Dataset split size: 7766 samples.
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:128] - [DATASET INIT - train] Base RGB Transforms: Compose(
      ToImage()
      ToDtype(scale=True)
      Resize(size=[448, 448], interpolation=InterpolationMode.BICUBIC, antialias=True)
      Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225], inplace=False)
)
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:54] - [DATASET INIT - val] Root: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection, ImgSize: (448, 448), Normalize: True
2025-05-30 06:39:52 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - val] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Original Dataset
2025-05-30 06:39:53 - phase4_finetuning.dataset - INFO - [__init__:74] - [DATASET INIT - val] Scanning: /teamspace/studios/this_studio/cvpr25/SAR-CLD-2024 A Comprehensive Dataset for Cotton Leaf Disease Detection/Augmented Dataset
2025-05-30 06:39:53 - phase4_finetuning.dataset - INFO - [__init__:105] - [DATASET INIT - val] Total valid image paths collected: 9137 from ~9137 items considered.
2025-05-30 06:39:53 - phase4_finetuning.dataset - INFO - [__init__:117] - [DATASET INIT - val] Dataset split size: 1371 samples.
2025-05-30 06:39:53 - phase4_finetuning.dataset - INFO - [__init__:128] - [DATASET INIT - val] Base RGB Transforms: Compose(
      ToImage()
      ToDtype(scale=True)
      Resize(size=[448, 448], interpolation=InterpolationMode.BICUBIC, antialias=True)
      Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225], inplace=False)
)
2025-05-30 06:39:53 - __main__ - INFO - [main_execution_logic:331] - Datasets loaded. Train samples: 7766, Val samples: 1371. Classes: ['Bacterial Blight', 'Curl Virus', 'Healthy Leaf', 'Herbicide Growth Damage', 'Leaf Hopper Jassids', 'Leaf Redding', 'Leaf Variegation']
2025-05-30 06:39:53 - __main__ - INFO - [main_execution_logic:347] - Using WeightedRandomSampler with 'sqrt_inv_count' mode. Per-class weights: [0.031 0.029 0.031 0.03  0.031 0.027 0.032]
2025-05-30 06:39:53 - __main__ - INFO - [main_execution_logic:358] - WeightedRandomSampler enabled (mode: sqrt_inv_count).
2025-05-30 06:39:53 - __main__ - INFO - [main_execution_logic:365] - Dataloaders created. Train batches: 970, Val batches: 172
2025-05-30 06:39:53 - phase2_model.models.hvt - INFO - [create_disease_aware_hvt:602] - Factory: Creating DiseaseAwareHVT for img_size: (448, 448), num_classes: 7
2025-05-30 06:39:56 - phase2_model.models.hvt - INFO - [__init__:325] - HVT: Running RGB stream only. No fusion.
2025-05-30 06:39:58 - phase2_model.models.hvt - INFO - [__init__:359] - DiseaseAwareHVT initialized for image size (448, 448) and 7 classes.
2025-05-30 06:39:58 - __main__ - INFO - [main_execution_logic:374] - Attempting to load full finetuning state from: /teamspace/studios/this_studio/cvpr25/phase4_finetuning/logs_finetune_optimized_strategy_v1_stable/checkpoints_optimized_strategy_v1_stable/best_finetuned_hvt_optimized_strategy_v1_stable.pth
2025-05-30 06:39:59 - __main__ - ERROR - [main_execution_logic:389] - Finetuning checkpoint /teamspace/studios/this_studio/cvpr25/phase4_finetuning/logs_finetune_optimized_strategy_v1_stable/checkpoints_optimized_strategy_v1_stable/best_finetuned_hvt_optimized_strategy_v1_stable.pth lacks 'model_state_dict'. Cannot resume model weights from it. Will proceed with SSL backbone loading if configured.
2025-05-30 06:39:59 - __main__.load_and_prepare_hvt_model - INFO - [load_and_prepare_hvt_model:183] - Loading SSL backbone weights from: /teamspace/studios/this_studio/cvpr25/phase3_pretraining/pretrain_checkpoints_hvt_xl/hvt_xl_simclr_t4_resumed_best_probe.pth
2025-05-30 06:40:02 - __main__.load_and_prepare_hvt_model - INFO - [load_and_prepare_hvt_model:203] - SSL and Finetune img_size match: (448, 448).
2025-05-30 06:40:02 - __main__.load_and_prepare_hvt_model - INFO - [load_and_prepare_hvt_model:261] - SSL Backbone weights loaded: 449 direct, 1 PE interpolated, 2 head layers skipped from SSL.
2025-05-30 06:40:02 - __main__.load_and_prepare_hvt_model - WARNING - [load_and_prepare_hvt_model:262] - Missing keys when loading SSL backbone: ['classifier_head.weight', 'classifier_head.bias']
2025-05-30 06:40:02 - __main__.load_and_prepare_hvt_model - INFO - [load_and_prepare_hvt_model:284] - Re-initialized HVT classifier_head for 7 classes (in_features=1536).
2025-05-30 06:40:03 - __main__ - INFO - [main_execution_logic:397] - Model ready. Total params: 273,615,751, Trainable params: 273,615,751
2025-05-30 06:40:03 - phase4_finetuning.utils.augmentations - INFO - [create_augmentation:268] - Creating augmentation strategy: 'stable_enhanced' with img_size: (448, 448), kwargs: {'severity': 'moderate'}
2025-05-30 06:40:03 - phase4_finetuning.utils.augmentations - INFO - [__init__:124] - StableEnhancedFinetuneAugmentation initialized with 'moderate' severity for stability.
2025-05-30 06:40:03 - __main__ - CRITICAL - [<module>:717] - Unhandled CRITICAL exception in __main__: SARCLD2024Dataset.get_class_weights() got an unexpected keyword argument 'mode'
Traceback (most recent call last):
  File "/teamspace/studios/this_studio/cvpr25/phase4_finetuning/main.py", line 707, in <module>
    try: main_execution_logic()
  File "/teamspace/studios/this_studio/cvpr25/phase4_finetuning/main.py", line 414, in main_execution_logic
    retrieved_loss_weights = train_dataset.get_class_weights(mode='inverse_frequency_clamped') # Or other robust mode
TypeError: SARCLD2024Dataset.get_class_weights() got an unexpected keyword argument 'mode'
